<!doctype html>
<html lang="ka">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="referrer" content="no-referrer" />
    <title>Admin Command Center â€” Game Debate v4.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Oswald:wght@400;700&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --bg: #050208;
            --panel: rgba(20, 15, 30, 0.7);
            --panel-2: rgba(30, 25, 50, 0.85);
            --accent: #8a4dff;
            --accent-glow: rgba(138, 77, 255, 0.4);
            --accent-2: #b58bff;
            --muted: #a496b8;
            --text: #f2eef7;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.1);
            --danger: #ff4757;
            --success: #2ed573;
            --shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            box-sizing: border-box;
            outline: none;
        }

        body {
            margin: 0;
            color: var(--text);
            font-family: "Rajdhani", sans-serif;
            background: var(--bg);
            overflow: hidden;
            /* Control scroll within dashboard */
            width: 100vw;
            height: 100vh;
            display: none;
            /* Security check */
        }

        /* CYBER BACKGROUND */
        #modern-background {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: linear-gradient(-45deg, #050208, #120626, #240c42, #0d041c);
            background-size: 400% 400%;
            animation: modernGradient 18s ease infinite;
        }

        @keyframes modernGradient {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* DASHBOARD LAYOUT */
        .dashboard {
            display: flex;
            width: 100%;
            height: 100vh;
            backdrop-filter: blur(20px);
        }

        /* SIDEBAR */
        .sidebar {
            width: 320px;
            background: rgba(15, 10, 25, 0.9);
            border-right: 1px solid var(--glass-border);
            padding: 40px 0;
            display: flex;
            flex-direction: column;
            z-index: 100;
        }

        .logo-area {
            padding: 0 40px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 30px;
        }

        .logo {
            font-family: "Oswald";
            font-size: 24px;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #fff;
            text-decoration: none;
        }

        .logo b {
            color: var(--accent);
        }

        .menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .menu-item {
            padding: 18px 40px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--muted);
            cursor: pointer;
            transition: var(--transition);
            border-left: 4px solid transparent;
            font-weight: 600;
            font-size: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .menu-item:hover,
        .menu-item.active {
            background: rgba(138, 77, 255, 0.1);
            color: #fff;
            border-left-color: var(--accent);
        }

        .menu-item i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        .user-info {
            margin-top: auto;
            padding: 30px 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--accent);
            object-fit: cover;
        }

        .user-details h4 {
            margin: 0;
            font-size: 16px;
            color: #fff;
        }

        .user-details p {
            margin: 0;
            font-size: 12px;
            color: var(--accent-2);
            text-transform: uppercase;
        }

        /* CONTENT AREA */
        .content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 40px 60px;
            background: rgba(0, 0, 0, 0.2);
        }

        .header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .section-title {
            font-family: "Oswald";
            font-size: 32px;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-bottom: 50px;
        }

        .stat-card {
            background: var(--panel);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 30px;
            transition: var(--transition);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-card:hover {
            transform: translateY(-10px);
            border-color: var(--accent);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .stat-label {
            font-size: 12px;
            font-weight: 700;
            color: var(--accent-2);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        .stat-value {
            font-family: "Oswald";
            font-size: 42px;
            color: #fff;
            font-weight: 700;
        }

        /* TABLE SECTION */
        .data-table-container {
            background: var(--panel);
            border: 1px solid var(--glass-border);
            border-radius: 30px;
            overflow: hidden;
            box-shadow: var(--shadow);
        }

        .table-header {
            padding: 30px 40px;
            background: rgba(255, 255, 255, 0.03);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-title {
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th {
            padding: 20px 40px;
            text-align: left;
            font-size: 11px;
            text-transform: uppercase;
            color: var(--muted);
            border-bottom: 1px solid var(--glass-border);
        }

        .data-table td {
            padding: 18px 40px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
            font-size: 14px;
        }

        .data-table tr:hover td {
            background: rgba(138, 77, 255, 0.05);
        }

        .badge {
            padding: 5px 12px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .badge.admin {
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            border: 1px solid #ff4757;
        }

        .badge.user {
            background: rgba(46, 213, 115, 0.2);
            color: #2ed573;
            border: 1px solid #2ed573;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            color: #fff;
            padding: 8px 15px;
            border-radius: 12px;
            font-size: 12px;
            cursor: pointer;
            transition: 0.3s;
            margin-right: 5px;
        }

        .action-btn:hover {
            background: var(--accent);
            border-color: var(--accent);
        }

        .action-btn.del {
            color: var(--danger);
        }

        .action-btn.del:hover {
            background: var(--danger);
            color: #fff;
        }

        /* UTILS */
        .notification {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--accent);
            padding: 15px 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            transform: translateX(200%);
            transition: 0.6s cubic-bezier(0.19, 1, 0.22, 1);
            z-index: 10000;
        }

        .notification.active {
            transform: translateX(0);
        }

        /* FORM SECTION */
        .form-section {
            display: none;
            max-width: 800px;
            margin: 0 auto;
            background: var(--panel-2);
            padding: 50px;
            border-radius: 40px;
            border: 1px solid var(--glass-border);
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-size: 12px;
            text-transform: uppercase;
            font-weight: 700;
            color: var(--muted);
            margin-bottom: 10px;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid var(--glass-border);
            border-radius: 15px;
            color: #fff;
            font-family: inherit;
            font-size: 15px;
        }

        .form-input:focus,
        .form-textarea:focus {
            border-color: var(--accent);
        }

        .form-textarea {
            height: 200px;
            resize: none;
        }

        /* SCROLLBAR */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(138, 77, 255, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent);
        }

        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
                padding: 20px 0;
            }

            .logo span,
            .menu-item span,
            .user-details {
                display: none;
            }

            .menu-item {
                justify-content: center;
                padding: 20px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>

<body>
    <div id="modern-background"></div>
    <div id="toast" class="notification">áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ áƒ¨áƒ”áƒ¡áƒ áƒ£áƒšáƒ”áƒ‘áƒ£áƒšáƒ˜áƒ</div>

    <div class="dashboard">
        <aside class="sidebar">
            <div class="logo-area">
                <a href="index.html" class="logo"><b>GAME</b> <span>DEBATE</span></a>
            </div>
            <ul class="menu">
                <li class="menu-item active" onclick="showSection('users')"><i>ğŸ‘¥</i> <span>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜</span></li>
                <li class="menu-item" onclick="showSection('news')"><i>ğŸ“°</i> <span>áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜</span></li>
                <li class="menu-item" onclick="showSection('logs')"><i>ğŸ“‹</i> <span>áƒšáƒáƒ’áƒ”áƒ‘áƒ˜</span></li>
                <li class="menu-item" onclick="window.location.href='index.html'" style="margin-top:20px; opacity:0.6;">
                    <i>ğŸ </i> <span>áƒ¡áƒáƒ˜áƒ¢áƒ–áƒ” áƒ“áƒáƒ‘áƒ áƒ£áƒœáƒ”áƒ‘áƒ</span>
                </li>
            </ul>
            <div class="user-info" id="adminBadge">
                <img src="" class="avatar" id="adminAvatar">
                <div class="user-details">
                    <h4 id="adminName">Admin</h4>
                    <p>Super Administrator</p>
                </div>
            </div>
        </aside>

        <main class="content">
            <div id="usersSection" class="admin-section">
                <div class="header-bar">
                    <h1 class="section-title">áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h1>
                    <button class="action-btn"
                        style="background:var(--accent); border:none; padding:12px 25px; border-radius:15px; font-weight:700;">áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜
                        (CSV)</button>
                </div>

                <div class="stats-grid">
                    <div class="stat-card"><span class="stat-label">áƒ¡áƒ£áƒš áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜</span>
                        <div class="stat-value" id="statTotalUsers">0</div>
                    </div>
                    <div class="stat-card"><span class="stat-label">áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ˜</span>
                        <div class="stat-value" id="statAdmins">0</div>
                    </div>
                    <div class="stat-card"><span class="stat-label">áƒ“áƒ¦áƒ˜áƒ£áƒ áƒ˜ áƒ áƒ”áƒ’áƒ˜áƒ¡áƒ¢áƒ áƒáƒªáƒ˜áƒ</span>
                        <div class="stat-value">12</div>
                    </div>
                    <div class="stat-card"><span class="stat-label">áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ”áƒ‘áƒ˜áƒ¡ áƒ®áƒáƒ áƒ˜áƒ¡áƒ®áƒ˜</span>
                        <div class="stat-value" style="color:var(--success)">100%</div>
                    </div>
                </div>

                <div class="data-table-container">
                    <div class="table-header">
                        <span class="table-title">áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ—áƒ áƒ¡áƒ˜áƒ</span>
                        <input type="text" placeholder="áƒ«áƒ”áƒ‘áƒœáƒ (Username, Email)..." class="form-input"
                            style="width:300px; padding:10px 20px; margin:0;" id="userSearch">
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</th>
                                <th>áƒ”áƒš-áƒ¤áƒáƒ¡áƒ¢áƒ</th>
                                <th>áƒ¡áƒ¢áƒáƒ¢áƒ£áƒ¡áƒ˜</th>
                                <th>IP áƒ›áƒ˜áƒ¡áƒáƒ›áƒáƒ áƒ—áƒ˜</th>
                                <th>áƒ‘áƒáƒšáƒ áƒ¨áƒ”áƒ¡áƒ•áƒšáƒ</th>
                                <th>áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="newsSection" class="admin-section" style="display:none;">
                <div class="header-bar">
                    <h1 class="section-title">áƒ¡áƒ˜áƒáƒ®áƒšáƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ›áƒáƒ áƒ—áƒ•áƒ</h1>
                    <button class="action-btn" onclick="openPostForm()"
                        style="background:var(--success); border:none; padding:12px 25px; border-radius:15px; font-weight:700; color:#fff;">áƒáƒ®áƒáƒšáƒ˜
                        áƒáƒáƒ¡áƒ¢áƒ˜ +</button>
                </div>

                <div id="postForm" class="form-section">
                    <h2 style="font-family:Oswald; margin-top:0;">áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ“áƒáƒ›áƒáƒ¢áƒ”áƒ‘áƒ</h2>
                    <div class="form-group">
                        <label>áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</label>
                        <input type="text" id="postTitle" class="form-input" placeholder="áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜...">
                    </div>
                    <div class="form-group">
                        <label>áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ</label>
                        <select id="postCategory" class="form-input">
                            <option>Games</option>
                            <option>Hardware</option>
                            <option>Review</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>áƒ¡áƒ£áƒ áƒáƒ—áƒ˜áƒ¡ áƒšáƒ˜áƒœáƒ™áƒ˜ (URL)</label>
                        <input type="text" id="postImg" class="form-input" placeholder="https://...">
                    </div>
                    <div class="form-group">
                        <label>áƒ›áƒáƒ™áƒšáƒ” áƒáƒ¦áƒ¬áƒ”áƒ áƒ</label>
                        <input type="text" id="postExcerpt" class="form-input">
                    </div>
                    <div class="form-group">
                        <label>áƒ¡áƒ áƒ£áƒšáƒ˜ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜ (HTML áƒ›áƒ®áƒáƒ áƒ“áƒáƒ­áƒ”áƒ áƒ˜áƒ—)</label>
                        <textarea id="postFull" class="form-textarea"></textarea>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="action-btn" style="background:var(--accent); flex-grow:1; padding:15px;"
                            onclick="savePost()">áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ</button>
                        <button class="action-btn" style="flex-grow:1; padding:15px;"
                            onclick="closePostForm()">áƒ’áƒáƒ£áƒ¥áƒ›áƒ”áƒ‘áƒ</button>
                    </div>
                </div>

                <div class="data-table-container" id="newsTableContainer">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜</th>
                                <th>áƒ™áƒáƒ¢áƒ”áƒ’áƒáƒ áƒ˜áƒ</th>
                                <th>áƒ—áƒáƒ áƒ˜áƒ¦áƒ˜</th>
                                <th>áƒ›áƒáƒ¥áƒ›áƒ”áƒ“áƒ”áƒ‘áƒ</th>
                            </tr>
                        </thead>
                        <tbody id="newsTableBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="logsSection" class="admin-section" style="display:none;">
                <div class="header-bar">
                    <h1 class="section-title">áƒ£áƒ¡áƒáƒ¤áƒ áƒ—áƒ®áƒáƒ”áƒ‘áƒ˜áƒ¡ áƒšáƒáƒ’áƒ”áƒ‘áƒ˜</h1>
                </div>
                <div class="data-table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜</th>
                                <th>áƒ›áƒáƒ•áƒšáƒ”áƒœáƒ</th>
                                <th>IP / áƒšáƒáƒ™áƒáƒªáƒ˜áƒ</th>
                                <th>áƒ›áƒáƒ¬áƒ§áƒáƒ‘áƒ˜áƒšáƒáƒ‘áƒ</th>
                                <th>áƒ“áƒ áƒ</th>
                            </tr>
                        </thead>
                        <tbody id="logsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <script>
        // SECURITY FIRST
        const currentUser = JSON.parse(localStorage.getItem('currentUser'));
        if (!currentUser || currentUser.email !== 'jaro@gmail.com') {
            window.location.href = 'login.html';
        } else {
            document.body.style.display = 'block';
        }

        // STATE
        let allUsers = [];
        let activeNews = JSON.parse(localStorage.getItem('siteNewsData')) || [
            { id: 1, category: "Hardware", title: "NVIDIA RTX 60 áƒ¡áƒ”áƒ áƒ˜áƒ˜áƒ¡ áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ áƒ“áƒ”áƒ¢áƒáƒšáƒ”áƒ‘áƒ˜", date: "2026-02-08", excerpt: "áƒ˜áƒœáƒ¡áƒáƒ˜áƒ“áƒ”áƒ áƒ£áƒšáƒ˜ áƒ˜áƒœáƒ¤áƒáƒ áƒ›áƒáƒªáƒ˜áƒ˜áƒ—, NVIDIA-áƒ¡ áƒáƒ®áƒáƒšáƒ˜ áƒ—áƒáƒáƒ‘áƒ˜áƒ¡ áƒ•áƒ˜áƒ“áƒ”áƒ áƒ‘áƒáƒ áƒáƒ—áƒ”áƒ‘áƒ˜ 3-áƒ¯áƒ”áƒ  áƒ£áƒ¤áƒ áƒ áƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜ áƒ˜áƒ¥áƒœáƒ”áƒ‘áƒ AI áƒ’áƒáƒ›áƒáƒ—áƒ•áƒšáƒ”áƒ‘áƒ¨áƒ˜.", img: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=1200" },
            { id: 2, category: "Games", title: "GTA VI-áƒ˜áƒ¡ áƒáƒ®áƒáƒšáƒ˜ áƒ áƒ”áƒ™áƒáƒ áƒ“áƒ˜ - 100 áƒ›áƒ˜áƒšáƒ˜áƒáƒœáƒ˜", date: "2026-02-07", excerpt: "Rockstar Games-áƒ›áƒ áƒáƒ¤áƒ˜áƒªáƒ˜áƒáƒšáƒ£áƒ áƒáƒ“ áƒ“áƒáƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ, áƒ áƒáƒ› GTA VI áƒ’áƒáƒ®áƒ“áƒ áƒ§áƒ•áƒ”áƒšáƒáƒ–áƒ” áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒáƒ“áƒ˜ áƒ›áƒ”áƒ“áƒ˜áƒ áƒáƒ áƒáƒ“áƒ£áƒ¥áƒ¢áƒ˜.", img: "https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=1200" },
            { id: 3, category: "Exclusives", title: "Elder Scrolls VI-áƒ˜áƒ¡ áƒ’áƒ”áƒ˜áƒ›áƒ¤áƒšáƒ”áƒ˜", date: "2026-02-06", excerpt: "Bethesda-áƒ¡ áƒ®áƒ”áƒšáƒ›áƒ«áƒ¦áƒ•áƒáƒœáƒ”áƒšáƒáƒ‘áƒáƒ› áƒ’áƒáƒœáƒáƒªáƒ®áƒáƒ“áƒ, áƒ áƒáƒ› áƒ—áƒáƒ›áƒáƒ¨áƒ˜ áƒ›áƒ–áƒáƒ“áƒ”áƒ‘áƒ˜áƒ¡ áƒ‘áƒáƒšáƒ áƒ”áƒ¢áƒáƒáƒ–áƒ”áƒ.", img: "https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=1200" },
            { id: 4, category: "Games", title: "The Witcher 4 áƒ¬áƒáƒ áƒ›áƒáƒ”áƒ‘áƒ áƒ“áƒáƒ˜áƒ¬áƒ§áƒ", date: "2026-02-05", excerpt: "CD Projekt Red-áƒ›áƒ áƒáƒ¤áƒ˜áƒªáƒ˜áƒáƒšáƒ£áƒ áƒáƒ“ áƒ“áƒáƒáƒ“áƒáƒ¡áƒ¢áƒ£áƒ áƒ, áƒ áƒáƒ› áƒáƒ áƒáƒ”áƒ¥áƒ¢áƒ–áƒ” áƒ£áƒ™áƒ•áƒ” 400-áƒ–áƒ” áƒ›áƒ”áƒ¢áƒ˜ áƒ“áƒ”áƒ•áƒ”áƒšáƒáƒáƒ”áƒ áƒ˜ áƒ›áƒ£áƒ¨áƒáƒáƒ‘áƒ¡.", img: "https://images.unsplash.com/photo-1534423861386-85a16f5d13fd?q=80&w=1200" }
        ];

        let editingNewsId = null;

        // AUTH HEADER HELPER
        function getHeader() {
            return {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${currentUser.token}`
            };
        }

        // CORE UI
        async function showSection(id) {
            document.querySelectorAll('.admin-section').forEach(s => s.style.display = 'none');
            document.getElementById(id + 'Section').style.display = 'block';
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            if (event) {
                const item = event.target.closest('.menu-item');
                if (item) item.classList.add('active');
            }
            if (id === 'users') await fetchUsers();
            if (id === 'news') renderNews();
            if (id === 'logs') await fetchLogs();
        }

        function notify(text) {
            const toast = document.getElementById('toast');
            toast.textContent = text;
            toast.classList.add('active');
            setTimeout(() => toast.classList.remove('active'), 3000);
        }

        // USERS LOGIC
        async function fetchUsers() {
            try {
                const res = await fetch('/api/users', { headers: getHeader() });
                if (!res.ok) throw new Error('áƒ¬áƒ•áƒ“áƒáƒ›áƒ áƒ£áƒ•áƒáƒ áƒ’áƒ˜áƒ¡áƒ˜áƒ');
                allUsers = await res.json();
                renderUsers();
            } catch (err) {
                notify('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒšáƒ”áƒ‘áƒ˜áƒ¡ áƒ¬áƒáƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡áƒáƒ¡');
                console.error(err);
            }
        }

        function renderUsers() {
            const tbody = document.getElementById('userTableBody');
            const search = document.getElementById('userSearch').value.toLowerCase();
            const filtered = allUsers.filter(u => u.username?.toLowerCase().includes(search) || u.email?.toLowerCase().includes(search));

            document.getElementById('statTotalUsers').textContent = allUsers.length;
            document.getElementById('statAdmins').textContent = allUsers.filter(u => u.role === 'admin' || u.email === 'jaro@gmail.com').length;

            tbody.innerHTML = filtered.map(u => `
        <tr>
          <td style="display:flex; align-items:center; gap:12px;">
            <img src="${u.avatar_url || 'https://ui-avatars.com/api/?name=' + u.username}" style="width:32px; height:32px; border-radius:50%; object-fit:cover;">
            <span style="font-weight:700;">${u.username}</span>
          </td>
          <td style="color:var(--muted)">${u.email}</td>
          <td><span class="badge ${u.role === 'admin' ? 'admin' : 'user'}">${u.role || 'User'}</span></td>
          <td style="font-family:monospace; opacity:0.8;">${u.last_ip || 'Hidden'}</td>
          <td style="font-size:12px;">${u.last_login_at ? new Date(u.last_login_at).toLocaleDateString('ka-GE') : 'áƒ“áƒáƒ¤áƒ˜áƒ¥áƒ¡áƒ˜áƒ áƒ”áƒ‘áƒ£áƒšáƒ˜ áƒáƒ  áƒáƒ áƒ˜áƒ¡'}</td>
          <td>
            <button class="action-btn" onclick="editUser('${u.email}')">Edit</button>
            <button class="action-btn del" onclick="deleteUser('${u.email}')">Ban</button>
          </td>
        </tr>
      `).join('');
        }

        document.getElementById('userSearch').oninput = renderUsers;

        async function deleteUser(email) {
            if (email === 'jaro@gmail.com') return notify('áƒáƒ“áƒ›áƒ˜áƒœáƒ˜áƒ¡áƒ¢áƒ áƒáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ áƒ¨áƒ”áƒ£áƒ«áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!');
            if (!confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ áƒ—?')) return;

            try {
                const res = await fetch('/api/users', {
                    method: 'DELETE',
                    headers: getHeader(),
                    body: JSON.stringify({ email })
                });
                if (res.ok) {
                    allUsers = allUsers.filter(u => u.email !== email);
                    renderUsers();
                    notify('áƒ›áƒáƒ›áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ”áƒšáƒ˜ áƒ“áƒáƒ‘áƒšáƒáƒ™áƒ˜áƒšáƒ˜áƒ');
                } else {
                    const data = await res.json();
                    notify(data.error || 'áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒ¬áƒáƒ¨áƒšáƒ˜áƒ¡áƒáƒ¡');
                }
            } catch (err) {
                notify('áƒ¡áƒ”áƒ áƒ•áƒ”áƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ');
            }
        }

        // NEWS LOGIC
        function renderNews() {
            const tbody = document.getElementById('newsTableBody');
            tbody.innerHTML = activeNews.map(n => `
        <tr>
          <td style="color:var(--accent-2); font-weight:700;">#${n.id}</td>
          <td style="font-weight:600;">${n.title}</td>
          <td><span class="badge" style="background:rgba(255,255,255,0.05); border:1px solid var(--glass-border);">${n.category}</span></td>
          <td style="font-size:12px;">${n.date}</td>
          <td>
            <button class="action-btn" onclick="editNews(${n.id})">Edit</button>
            <button class="action-btn del" onclick="deleteNews(${n.id})">Del</button>
          </td>
        </tr>
      `).join('');
        }

        function editNews(id) {
            const item = activeNews.find(n => n.id === id);
            if (!item) return;
            editingNewsId = id;
            document.getElementById('postTitle').value = item.title;
            document.getElementById('postCategory').value = item.category;
            document.getElementById('postImg').value = item.img || '';
            document.getElementById('postExcerpt').value = item.excerpt || '';
            document.getElementById('postFull').value = item.full || '';
            openPostForm();
        }

        function deleteNews(id) {
            if (!confirm('áƒ“áƒáƒ áƒ¬áƒ›áƒ£áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜ áƒ®áƒáƒ áƒ— áƒ áƒáƒ› áƒ’áƒ¡áƒ£áƒ áƒ— áƒ¡áƒ˜áƒáƒ®áƒšáƒ˜áƒ¡ áƒ¬áƒáƒ¨áƒšáƒ?')) return;
            activeNews = activeNews.filter(n => n.id !== id);
            localStorage.setItem('siteNewsData', JSON.stringify(activeNews));
            renderNews();
            notify('áƒ¡áƒ˜áƒáƒ®áƒšáƒ” áƒ¬áƒáƒ˜áƒ¨áƒáƒšáƒ');
        }

        function openPostForm() {
            document.getElementById('newsTableContainer').style.display = 'none';
            document.getElementById('postForm').style.display = 'block';
        }
        function closePostForm() {
            document.getElementById('newsTableContainer').style.display = 'block';
            document.getElementById('postForm').style.display = 'none';
        }

        function savePost() {
            const title = document.getElementById('postTitle').value;
            const category = document.getElementById('postCategory').value;
            const img = document.getElementById('postImg').value;
            const excerpt = document.getElementById('postExcerpt').value;
            const full = document.getElementById('postFull').value;

            if (!title) return notify('áƒ¡áƒáƒ—áƒáƒ£áƒ áƒ˜ áƒáƒ£áƒªáƒ˜áƒšáƒ”áƒ‘áƒ”áƒšáƒ˜áƒ!');

            if (editingNewsId) {
                const idx = activeNews.findIndex(n => n.id === editingNewsId);
                activeNews[idx] = { ...activeNews[idx], title, category, img, excerpt, full };
            } else {
                const newId = activeNews.length > 0 ? Math.max(...activeNews.map(n => n.id)) + 1 : 1;
                activeNews.unshift({
                    id: newId,
                    title,
                    category,
                    img,
                    excerpt,
                    full,
                    date: new Date().toLocaleDateString('en-US', { month: 'long', day: '2-digit', year: 'numeric' })
                });
            }

            localStorage.setItem('siteNewsData', JSON.stringify(activeNews));
            editingNewsId = null;
            renderNews();
            notify('áƒ¡áƒ˜áƒáƒ®áƒšáƒ” áƒ¨áƒ”áƒœáƒáƒ®áƒ£áƒšáƒ˜áƒ áƒ“áƒ áƒ’áƒáƒ›áƒáƒ¥áƒ•áƒ”áƒ§áƒœáƒ”áƒ‘áƒ£áƒšáƒ˜áƒ');
            closePostForm();
        }

        // LOGS LOGIC
        async function fetchLogs() {
            try {
                const res = await fetch('/api/security-logs', { headers: getHeader() });
                const data = await res.json();
                const tbody = document.getElementById('logsTableBody');

                tbody.innerHTML = data.logs.map(log => `
            <tr>
              <td>${log.email}</td>
              <td><b style="color:${log.event_type.includes('SUCCESS') ? 'var(--success)' : 'var(--danger)'}">${log.event_type}</b></td>
              <td style="font-family:monospace;">${log.ip_address || 'Unknown'} (${log.country || '??'})</td>
              <td style="font-size:11px;">${log.device || 'Unknown'} / ${log.browser || 'Unknown'}</td>
              <td style="font-size:12px;">${new Date(log.attempt_at).toLocaleString('ka-GE')}</td>
            </tr>
          `).join('');
            } catch (err) {
                notify('áƒ¨áƒ”áƒªáƒ“áƒáƒ›áƒ áƒšáƒáƒ’áƒ”áƒ‘áƒ˜áƒ¡ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡áƒáƒ¡');
            }
        }

        // INIT
        document.getElementById('adminName').textContent = currentUser.username;
        document.getElementById('adminAvatar').src = currentUser.avatar_url || 'https://ui-avatars.com/api/?name=' + currentUser.username;
        fetchUsers();
    </script>
</body>

</html>